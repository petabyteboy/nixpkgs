From 57bbed620f63a6e46dc0cd733d0f26d616c98eaa Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Milan=20P=C3=A4ssler?= <me@pbb.lc>
Date: Sat, 4 Apr 2020 00:27:41 +0200
Subject: [PATCH 04/10] qtbase-replace-libdir

---
 mkspecs/features/qt_common.prf | 20 ++------------------
 mkspecs/features/qt_module.prf |  5 +----
 2 files changed, 3 insertions(+), 22 deletions(-)

diff --git a/mkspecs/features/qt_common.prf b/mkspecs/features/qt_common.prf
index c24f2c6062..0d72ce7286 100644
--- a/mkspecs/features/qt_common.prf
+++ b/mkspecs/features/qt_common.prf
@@ -31,32 +31,16 @@ contains(TEMPLATE, .*lib) {
         rplbase = $$dirname(_QMAKE_SUPER_CACHE_)/[^/][^/]*
     else: \
         rplbase = $$MODULE_BASE_OUTDIR
-    host_build {
-        qqt_libdir = \$\$\$\$[QT_HOST_LIBS]
-        qt_libdir = $$[QT_HOST_LIBS]
-    } else {
-        qqt_libdir = \$\$\$\$[QT_INSTALL_LIBS]
-        qt_libdir = $$[QT_INSTALL_LIBS]
-    }
+    qt_libdir = $$NIX_OUTPUT_OUT/lib
     contains(QMAKE_DEFAULT_LIBDIRS, $$qt_libdir) {
-        lib_replace0.match = $$rplbase/lib/
-        lib_replace0.replace = $$qqt_libdir/
-        lib_replace0.CONFIG = path
-        QMAKE_PRL_INSTALL_REPLACE += lib_replace0
         lib_replace.match = "[^ ']*$$rplbase/lib"
         lib_replace.replace =
     } else {
         lib_replace.match = $$rplbase/lib
-        lib_replace.replace = $$qqt_libdir
+        lib_replace.replace = $$qt_libdir
     }
     lib_replace.CONFIG = path
     QMAKE_PRL_INSTALL_REPLACE += lib_replace
-    !equals(qt_libdir, $$rplbase/lib) {
-        qtlibdir_replace.match = $$qt_libdir
-        qtlibdir_replace.replace = $$qqt_libdir
-        qtlibdir_replace.CONFIG = path
-        QMAKE_PRL_INSTALL_REPLACE += qtlibdir_replace
-    }
 }
 
 # The remainder of this file must not apply to host tools/libraries,
diff --git a/mkspecs/features/qt_module.prf b/mkspecs/features/qt_module.prf
index 828a9621b9..16b39031bc 100644
--- a/mkspecs/features/qt_module.prf
+++ b/mkspecs/features/qt_module.prf
@@ -272,10 +272,7 @@ load(qt_targets)
 !internal_module:if(unix|mingw):!if(darwin:debug_and_release:CONFIG(debug, debug|release)) {
     CONFIG += create_pc
     QMAKE_PKGCONFIG_DESTDIR = pkgconfig
-    host_build: \
-        QMAKE_PKGCONFIG_LIBDIR = $$[QT_HOST_LIBS]
-    else: \
-        QMAKE_PKGCONFIG_LIBDIR = $$[QT_INSTALL_LIBS/raw]
+    QMAKE_PKGCONFIG_LIBDIR = $$NIX_OUTPUT_OUT/lib
     lib_bundle {
         QMAKE_PKGCONFIG_INCDIR = $$[QT_INSTALL_LIBS/raw]/$${MODULE_INCNAME}.framework/Headers
         QMAKE_PKGCONFIG_CFLAGS = -D$$MODULE_DEFINE
-- 
2.25.1

